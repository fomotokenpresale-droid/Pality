<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wallet UI Replica</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f6f7fb; color: #1a1a1a; }
    .header { padding: 20px; text-align: center; font-size: 20px; font-weight: 600; background: white; position: sticky; top: 0; }
    .search { margin: 15px; padding: 10px; border-radius: 12px; border: 1px solid #ccc; width: calc(100% - 30px); }
    .wallet-section { text-align: left; padding: 0 20px; }
    .balance { font-size: 36px; font-weight: bold; }
    .actions { display: flex; justify-content: space-around; padding: 20px 0; background: white; }
    .action { display: flex; flex-direction: column; align-items: center; font-size: 14px; cursor: pointer; }
    .circle { width: 55px; height: 55px; border-radius: 50%; background: #eee; display: flex; justify-content: center; align-items: center; margin-bottom: 8px; font-size: 22px; }
    .crypto-list { padding: 0 20px 80px 20px; }
    .coin { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #ddd; cursor: pointer; }
    .coin-info { display: flex; align-items: center; gap: 12px; }
    .coin img { width: 32px; height: 32px; }
    .footer { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ccc; }
    .footer div { text-align: center; font-size: 14px; }

    #btcPage { display:none; padding:20px; }
    #sendBTC { position: fixed; inset: 0; background: white; display: none; flex-direction: column; padding: 20px; z-index: 99999; overflow-y: auto; }
    #confirmSend { position:fixed; inset:0; background:#ffffff; display:none; flex-direction:column; padding:20px; z-index:999999; overflow-y:auto; }

    #processingPopup { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000000; }
    .processing-card { background: #fff; padding: 24px; border-radius: 14px; width: calc(100% - 64px); max-width: 360px; text-align: center; }
    .spinner { width: 56px; height: 56px; border-radius: 50%; border: 6px solid #e6e6e6; border-top-color: #0a53ff; margin: 0 auto 14px; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .processing-title { font-weight:700; margin-bottom:8px; }
    .processing-text { color:#555; font-size:14px; }

    #txDetails { display:none; padding:20px; }
    .tx-row { display:flex; justify-content:space-between; margin-bottom:10px; }
    .status-pending { color:#f59e0b; font-weight:700; }
    .status-success { color:#10b981; font-weight:700; }

    @media(min-width:700px){ .container{max-width:720px;margin:0 auto} }
  </style>
</head>
<body>
  <div class="header">Home</div>

  <input class="search" placeholder="Search" />

  <div class="wallet-section">
    <div>Main Wallet 4</div>
    <div class="balance" id="mainBalance">$0.00</div>
  </div>

  <div class="actions">
    <div class="action"><div class="circle">‚Üë</div>Send</div>
    <div class="action"><div class="circle">‚Üì</div>Receive</div>
    <div class="action"><div class="circle">‚ñ£</div>Buy</div>
    <div class="action"><div class="circle">üè¶</div>Sell</div>
    <div class="action"><div class="circle">‚ü≥</div>History</div>
  </div>

  <div class="crypto-list">
    <!-- BTC -->
    <div class="coin" id="btcRow">
      <div class="coin-info">
        <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" />
        <div>
          <div>BTC</div>
          <small id="btcPriceText">Loading...</small>
        </div>
      </div>
      <div id="btcWalletBalance">0 BTC ($0.00)</div>
    </div>

    <!-- SOL -->
    <div class="coin" id="solRow">
      <div class="coin-info">
        <img src="https://cryptologos.cc/logos/solana-sol-logo.png" />
        <div>
          <div>SOL</div>
          <small id="solPriceText">Loading...</small>
        </div>
      </div>
      <div id="solWalletBalance">0 SOL ($0.00)</div>
    </div>

    <!-- ETH -->
    <div class="coin" id="ethRow">
      <div class="coin-info">
        <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png" />
        <div>
          <div>ETH</div>
          <small id="ethPriceText">Loading...</small>
        </div>
      </div>
      <div id="ethWalletBalance">0 ETH ($0.00)</div>
    </div>

    <!-- BNB -->
    <div class="coin" id="bnbRow">
      <div class="coin-info">
        <img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" />
        <div>
          <div>BNB</div>
          <small id="bnbPriceText">Loading...</small>
        </div>
      </div>
      <div id="bnbWalletBalance">0 BNB ($0.00)</div>
    </div>

    <!-- MATIC -->
    <div class="coin" id="maticRow">
      <div class="coin-info">
        <img src="https://cryptologos.cc/logos/polygon-matic-logo.png" />
        <div>
          <div>MATIC</div>
          <small id="maticPriceText">Loading...</small>
        </div>
      </div>
      <div id="maticWalletBalance">0 MATIC ($0.00)</div>
    </div>
  </div>

  <div class="footer">
    <div>Home</div>
    <div>Swap</div>
    <div>Earn</div>
    <div>Discover</div>
  </div>

  <!-- BTC PAGE -->
  <div id="btcPage">
    <div id="backBtn" style="display:flex;align-items:center;gap:10px;cursor:pointer;font-size:18px;margin-bottom:20px;">‚Üê Back</div>
    <h2>Bitcoin</h2>
    <div style="text-align:center;margin-top:20px;">
     <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" width="80" alt="BTC logo" />
      <h3 id="btcHoldings">0 BTC</h3>
      <p id="btcHoldingsFiat">‚âà $0.00</p>
    </div>

    <div style='display:flex;justify-content:space-around;margin:20px 0;'>
      <div class='action' id="sendFromBTC"><div class='circle'>‚Üë</div>Send</div>
      <div class='action'><div class='circle'>‚Üì</div>Receive</div>
      <div class='action'><div class='circle'>‚ñ£</div>Buy</div>
      <div class='action'><div class='circle'>‚áÑ</div>Swap</div>
      <div class='action'><div class='circle'>üè¶</div>Sell</div>
    </div>

    <button style='background:#0a53ff;color:white;width:100%;padding:14px;border:none;border-radius:12px;font-size:16px;'>Buy BTC</button>

    <div style='margin-top:30px;border-top:1px solid #ddd;padding-top:15px;'>
      <strong>Current BTC price</strong>
      <div id="btcPriceDetail">Loading...</div>
    </div>
  </div>

  <!-- SEND SCREEN -->
  <div id="sendBTC">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h2 style="margin:0;">Send BTC</h2>
      <div id="closeSend" style="font-size:24px;cursor:pointer;">‚úï</div>
    </div>

    <div style="margin-top:25px;">
      <label>Address or Domain Name</label>
      <input id="sendAddress" type="text" placeholder="Search or Enter" style="width:100%;padding:14px;margin-top:6px;border-radius:12px;border:1px solid #ccc;font-size:16px;">
    </div>

    <div style="margin-top:25px;">
      <label>Amount</label>
      <input id="btcAmount" type="text" placeholder="BTC Amount" style="width:100%;padding:14px;margin-top:6px;border-radius:12px;border:1px solid #ccc;font-size:16px;">
      <div id="btcAmountFiat" style="color:#777;margin-top:5px;">‚âà $0.00</div>
    </div>

    <button id="nextBtn" style="margin-top:40px;width:100%;padding:16px;font-size:17px;border:none;background:#e5e6eb;border-radius:14px;color:#777;">Next</button>
  </div>

  <!-- CONFIRM SEND PAGE -->
  <div id="confirmSend">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <div id="backToSend" style="font-size:22px;cursor:pointer;">‚Üê</div>
      <h2 style="margin:0;font-weight:600;">Transfer</h2>
      <div></div>
    </div>

    <div id="confirmAmount" style="font-size:26px;font-weight:700;text-align:center;">0 BTC</div>
    <div id="confirmFiat" style="color:#666;text-align:center;margin-bottom:25px;">$0.00</div>

    <div style="background:#f3f3f3;border-radius:14px;padding:18px;margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span>Asset</span><span>Bitcoin (BTC)</span>
      </div>
      <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span>Wallet</span><span>Main Wallet</span>
      </div>
      <div style="display:flex;justify-content:space-between;">
        <span>To</span><span id="confirmTo">Address</span>
      </div>
    </div>

    <div style="background:#f3f3f3;border-radius:14px;padding:18px;margin-bottom:30px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span>Network fee</span><span id="confirmFee">0 BTC</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-weight:600;">
        <span>Max Total</span><span id="confirmTotal">$0.00</span>
      </div>
    </div>

    <button id="confirmBtn" style="background:#0a53ff;color:white;border:none;width:100%;padding:16px;border-radius:14px;font-size:18px;">Confirm</button>
  </div>

  <!-- PROCESSING POPUP -->
  <div id="processingPopup">
    <div class="processing-card">
      <div class="spinner"></div>
      <div class="processing-title">Processing</div>
      <div class="processing-text">Transaction in progress! Blockchain validation is underway...</div>
      <div class="processing-actions">
        <button id="processingDetails" class="btn primary">Transaction Details</button>
      </div>
    </div>
  </div>

  <!-- TX DETAILS -->
  <div id="txDetails">
    <div style="display:flex;justify-content:between;align-items:center;margin-bottom:18px;">
      <div id="txBack" style="cursor:pointer;font-weight:700;">‚óÄ Back</div>
      <div id="txStatus" class="status-pending">Pending</div>
    </div>

    <div id="txAmount" style="font-size:20px;font-weight:700;margin-bottom:8px;">0 BTC</div>
    <div id="txFiat" style="color:#666;margin-bottom:16px;">$0.00</div>

    <div style="background:#f3f3f3;border-radius:12px;padding:12px;margin-bottom:12px;">
      <div class="tx-row"><span>To</span><span id="txTo">Address</span></div>
      <div class="tx-row"><span>Fee</span><span id="txFee">0 BTC</span></div>
      <div class="tx-row"><span>Total</span><span id="txTotal">$0.00</span></div>
      <div class="tx-row"><span>Timestamp</span><span id="txTime">-</span></div>
    </div>

    <button id="txDone" class="btn primary">Done</button>
  </div>

<script>
/* ============================================
   üîµ MASTER PORTFOLIO (single source of truth)
   ============================================ */

const portfolio = {
  BTC: { amount: 0.67, api: 'bitcoin', price: 0, usd: 0 },
  SOL: { amount: 104, api: 'solana', price: 0, usd: 0 },
  ETH: { amount: 19, api: 'ethereum', price: 0, usd: 0 },
  BNB: { amount: 249, api: 'binancecoin', price: 0, usd: 0 },
  MATIC: { amount: 834, api: 'matic-network', price: 0, usd: 0 }
};

/* Helper: decimal formats per coin for display */
const displayConfig = {
  BTC: {decimals:8},
  ETH: {decimals:6},
  SOL: {decimals:4},
  BNB: {decimals:4},
  MATIC: {decimals:2}
};

/* Update UI from portfolio values */
function updateAllBalances() {
  // compute USD for each coin and total
  let totalUSD = 0;
  for (const sym in portfolio) {
    const p = portfolio[sym];
    p.usd = (p.amount || 0) * (p.price || 0);
    totalUSD += p.usd;
  }

  // MAIN BALANCE (total of all coins)
  const mainBalanceEl = document.getElementById('mainBalance');
  mainBalanceEl.innerText = `$${totalUSD.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`;

  // BTC UI
  const btc = portfolio.BTC;
  document.getElementById('btcWalletBalance').innerText = `${btc.amount.toFixed(displayConfig.BTC.decimals)} BTC ($${btc.usd.toLocaleString(undefined,{minimumFractionDigits:2})})`;
  document.getElementById('btcHoldings').innerText = `${btc.amount.toFixed(displayConfig.BTC.decimals)} BTC`;
  document.getElementById('btcHoldingsFiat').innerText = `‚âà $${btc.usd.toFixed(2)}`;

  // SOL UI
  const sol = portfolio.SOL;
  document.getElementById('solWalletBalance').innerText = `${sol.amount.toFixed(displayConfig.SOL.decimals)} SOL ($${sol.usd.toLocaleString(undefined,{minimumFractionDigits:2})})`;

  // ETH UI
  const eth = portfolio.ETH;
  document.getElementById('ethWalletBalance').innerText = `${eth.amount.toFixed(displayConfig.ETH.decimals)} ETH ($${eth.usd.toLocaleString(undefined,{minimumFractionDigits:2})})`;

  // BNB UI
  const bnb = portfolio.BNB;
  document.getElementById('bnbWalletBalance').innerText = `${bnb.amount.toFixed(displayConfig.BNB.decimals)} BNB ($${bnb.usd.toLocaleString(undefined,{minimumFractionDigits:2})})`;

  // MATIC UI
  const matic = portfolio.MATIC;
  document.getElementById('maticWalletBalance').innerText = `${matic.amount.toFixed(displayConfig.MATIC.decimals)} MATIC ($${matic.usd.toLocaleString(undefined,{minimumFractionDigits:2})})`;
}

/* ============================================
   üîµ FETCH PRICES (CoinGecko simple/price)
   ============================================ */

async function fetchAllPrices() {
  try {
    const ids = Object.values(portfolio).map(c => c.api).join(',');
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`;
    const res = await fetch(url);
    const data = await res.json();

    // assign prices back to portfolio
    for (const sym in portfolio) {
      const apiName = portfolio[sym].api;
      const price = data && data[apiName] && data[apiName].usd ? data[apiName].usd : 0;
      portfolio[sym].price = price;
    }

    // Update individual price labels
    document.getElementById('btcPriceText').innerText = `$${portfolio.BTC.price.toLocaleString()} (Live)`;
    document.getElementById('btcPriceDetail').innerText = `$${portfolio.BTC.price.toLocaleString()}`;

    document.getElementById('solPriceText').innerText = `$${portfolio.SOL.price.toLocaleString()} (Live)`;
    document.getElementById('ethPriceText').innerText = `$${portfolio.ETH.price.toLocaleString()} (Live)`;
    document.getElementById('bnbPriceText').innerText = `$${portfolio.BNB.price.toLocaleString()} (Live)`;
    document.getElementById('maticPriceText').innerText = `$${portfolio.MATIC.price.toLocaleString()} (Live)`;

    // Recalculate USD totals and update UI
    updateAllBalances();
  } catch (e) {
    // silently fail but keep UI unchanged
    console.error('Price fetch failed', e);
  }
}

/* initial load + periodic refresh */
fetchAllPrices();
setInterval(fetchAllPrices, 10000); // refresh every 10s

/* ======================================================
   EXISTING APP NAVIGATION & SEND FLOW (kept intact)
   ====================================================== */

const btcRow = document.getElementById('btcRow');
const btcPage = document.getElementById('btcPage');
const sendBTC = document.getElementById('sendBTC');
const confirmSend = document.getElementById('confirmSend');
const backBtn = document.getElementById('backBtn');
const sendFromBTC = document.getElementById('sendFromBTC');
const closeSend = document.getElementById('closeSend');
const backToSend = document.getElementById('backToSend');
const confirmBtn = document.getElementById('confirmBtn');

const processingPopup = document.getElementById('processingPopup');
const processingDetails = document.getElementById('processingDetails');

const txDetails = document.getElementById('txDetails');
const txBack = document.getElementById('txBack');
const txStatus = document.getElementById('txStatus');
const txAmount = document.getElementById('txAmount');
const txFiat = document.getElementById('txFiat');
const txTo = document.getElementById('txTo');
const txFee = document.getElementById('txFee');
const txTotal = document.getElementById('txTotal');
const txTime = document.getElementById('txTime');
const txDone = document.getElementById('txDone');

btcRow.addEventListener('click', () => {
  hideMain();
  btcPage.style.display = 'block';
});
backBtn.addEventListener('click', () => showMain());

function hideMain() {
  document.querySelector('.header').style.display = 'none';
  document.querySelector('.search').style.display = 'none';
  document.querySelector('.wallet-section').style.display = 'none';
  document.querySelector('.actions').style.display = 'none';
  document.querySelector('.crypto-list').style.display = 'none';
  document.querySelector('.footer').style.display = 'none';
}
function showMain() {
  document.querySelector('.header').style.display = '';
  document.querySelector('.search').style.display = '';
  document.querySelector('.wallet-section').style.display = '';
  document.querySelector('.actions').style.display = '';
  document.querySelector('.crypto-list').style.display = '';
  document.querySelector('.footer').style.display = '';
  btcPage.style.display = 'none';
}

sendFromBTC.addEventListener('click', () => {
  btcPage.style.display = 'none';
  sendBTC.style.display = 'flex';
});
closeSend.addEventListener('click', () => {
  sendBTC.style.display = 'none';
  btcPage.style.display = 'block';
});

/* ======================================================
   SEND PAGE ‚Äî FIAT PREVIEW (BTC only, unchanged behavior)
   ====================================================== */

const btcAmountEl = document.getElementById('btcAmount');
const btcAmountFiat = document.getElementById('btcAmountFiat');
const nextBtn = document.getElementById('nextBtn');
const sendAddress = document.getElementById('sendAddress');

btcAmountEl.addEventListener('input', () => {
  const val = parseFloat(btcAmountEl.value) || 0;
  // use live BTC price from portfolio
  btcAmountFiat.innerText = `‚âà $${(val * portfolio.BTC.price).toFixed(2)}`;

  if (val > 0) {
    nextBtn.style.background = '#0a53ff';
    nextBtn.style.color = '#FFFFFF';
    nextBtn.disabled = false;
  } else {
    nextBtn.style.background = '#e5e6eb';
    nextBtn.style.color = '#777';
    nextBtn.disabled = true;
  }
});

/* ======================================================
   CONFIRM SEND PAGE (keeps the same UI values)
   ====================================================== */

nextBtn.addEventListener('click', () => {
  const btc = parseFloat(btcAmountEl.value) || 0;
  const usd = btc * portfolio.BTC.price;
  const fee = btc * 0.01;

  document.getElementById('confirmAmount').innerText = `-${btc} BTC`;
  document.getElementById('confirmFiat').innerText = `‚âà $${usd.toFixed(2)}`;
  document.getElementById('confirmFee').innerText = `${fee.toFixed(8)} BTC`;
  document.getElementById('confirmTotal').innerText = `$${(usd + fee * portfolio.BTC.price).toFixed(2)}`;
  document.getElementById('confirmTo').innerText = sendAddress.value || 'No address';

  sendBTC.style.display = 'none';
  confirmSend.style.display = 'flex';
});

backToSend.addEventListener('click', () => {
  confirmSend.style.display = 'none';
  sendBTC.style.display = 'flex';
});

/* ======================================================
   FINAL CONFIRM ‚Äî DEDUCT BTC FROM PORTFOLIO
   ====================================================== */

confirmBtn.addEventListener('click', () => {
  processingPopup.style.display = 'flex';
  document.body.style.overflow = 'hidden';

  setTimeout(() => {
    const btc = parseFloat(document.getElementById('confirmAmount').innerText.replace('-', '').replace(' BTC','')) || 0;
    const feeText = document.getElementById('confirmFee').innerText;
    const fee = parseFloat(feeText.replace(' BTC','')) || 0;

    // deduct BTC amount from portfolio (single source of truth)
    portfolio.BTC.amount = Math.max(0, (portfolio.BTC.amount || 0) - btc);

    // recalc and update everything (main balance, all coins)
    updateAllBalances();

    // TX DETAILS population
    txStatus.className = 'status-success';
    txStatus.innerText = 'Successful';
    txAmount.innerText = `${btc} BTC`;
    txFiat.innerText = document.getElementById('confirmFiat').innerText;
    txTo.innerText = document.getElementById('confirmTo').innerText;
    txFee.innerText = feeText;
    txTotal.innerText = document.getElementById('confirmTotal').innerText;
    txTime.innerText = new Date().toLocaleString();

    processingPopup.style.display = 'none';
    confirmSend.style.display = 'none';
    txDetails.style.display = 'block';
    document.body.style.overflow = '';

  }, 2000);
});

processingDetails.addEventListener('click', () => {
  processingPopup.style.display = 'none';
  txDetails.style.display = 'block';
  document.body.style.overflow = '';
});

txBack.addEventListener('click', () => {
  txDetails.style.display = 'none';
  showMain();
});
txDone.addEventListener('click', () => {
  txDetails.style.display = 'none';
  showMain();
});

/* initialize UI right away (0 prices until fetch completes) */
updateAllBalances();

</script>

</body>
</html>
